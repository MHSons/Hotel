// AlphaMed Global Script (app.js)
function applyLabSettings(){ const s=JSON.parse(localStorage.getItem('labSettings')||'{}'); if(s.labName && document.title.indexOf(s.labName)===-1){ document.title = document.title + ' | ' + s.labName } if(s.logo){ const wm=document.createElement('div'); wm.className='auto-watermark'; wm.style.position='fixed'; wm.style.top='0'; wm.style.left='0'; wm.style.width='100%'; wm.style.height='100%'; wm.style.background=`url('${s.logo}') center center no-repeat`; wm.style.backgroundSize='400px'; wm.style.opacity='0.05'; wm.style.pointerEvents='none'; wm.style.zIndex='-1'; document.body.appendChild(wm); } if(s.labWhatsApp){ const wa=document.createElement('a'); const num=s.labWhatsApp.replace(/\D/g,''); let dial=num; if(num.length===10) dial='92'+num; wa.href='https://wa.me/'+dial+'?text='+encodeURIComponent('Hello '+(s.labName||'')); wa.target='_blank'; wa.innerText='ðŸ’¬'; wa.style.position='fixed'; wa.style.bottom='20px'; wa.style.right='20px'; wa.style.background='#25d366'; wa.style.color='white'; wa.style.fontSize='22px'; wa.style.borderRadius='50%'; wa.style.padding='10px 14px'; wa.style.textDecoration='none'; wa.style.boxShadow='0 4px 10px rgba(0,0,0,0.3)'; wa.style.zIndex='999'; document.body.appendChild(wa); } }
function getCurrentUser(){ return JSON.parse(localStorage.getItem('loggedUser')||'null') }
function requireLogin(roles=[]){ const u=getCurrentUser(); if(!u){ alert('Please login'); window.location='index.html'; return false } if(roles.length && !roles.includes(u.role)){ alert('Access denied'); window.location='dashboard.html'; return false } return true }
function logout(){ if(confirm('Logout?')){ localStorage.removeItem('loggedUser'); window.location='index.html' } }
window.addEventListener('DOMContentLoaded',applyLabSettings);
